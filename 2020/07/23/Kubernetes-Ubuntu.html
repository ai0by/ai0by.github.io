<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Ubuntu18.04部署Kubernetes(k8s)集群可视化界面Dashboard | 风向标 | 分享与创造</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Docker,架构">
    <meta name="description" content="k8s概念架构 Kubernetes是一个完备的分布式系统支撑平台。Kubernetes具有完备的集群管理能力，包括多层次的安全防护和准入机制/多租户应用支撑能力、透明的服务注册和服务发现机制、内建智能负载均衡器、强大的故障发现和自我修复功能、服务滚动升级和在线扩容能力、可扩展的资源自动调度机制，以及多粒度的资源配额管理能力。同时kubernetes提供了完善的管理工具，这些工具覆盖了包括开发、测">
<meta name="keywords" content="Docker,架构">
<meta property="og:type" content="article">
<meta property="og:title" content="Ubuntu18.04部署Kubernetes(k8s)集群可视化界面Dashboard">
<meta property="og:url" content="https://sbcoder.cn/2020/07/23/Kubernetes-Ubuntu.html">
<meta property="og:site_name" content="风向标 | 分享与创造">
<meta property="og:description" content="k8s概念架构 Kubernetes是一个完备的分布式系统支撑平台。Kubernetes具有完备的集群管理能力，包括多层次的安全防护和准入机制/多租户应用支撑能力、透明的服务注册和服务发现机制、内建智能负载均衡器、强大的故障发现和自我修复功能、服务滚动升级和在线扩容能力、可扩展的资源自动调度机制，以及多粒度的资源配额管理能力。同时kubernetes提供了完善的管理工具，这些工具覆盖了包括开发、测">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://s1.ax1x.com/2020/07/20/U4kh5j.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/07/20/U4AzTg.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/07/21/UIKJMQ.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/07/21/UIDylQ.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/07/21/UIrVtf.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/07/22/UHburQ.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/07/22/UHb15q.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/07/22/UHbNMF.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/07/22/UHb0aR.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/07/22/UHbhdA.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/07/22/UHb7z8.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/07/22/UHqnW6.png">
<meta property="og:updated_time" content="2020-07-23T06:03:37.256Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ubuntu18.04部署Kubernetes(k8s)集群可视化界面Dashboard">
<meta name="twitter:description" content="k8s概念架构 Kubernetes是一个完备的分布式系统支撑平台。Kubernetes具有完备的集群管理能力，包括多层次的安全防护和准入机制/多租户应用支撑能力、透明的服务注册和服务发现机制、内建智能负载均衡器、强大的故障发现和自我修复功能、服务滚动升级和在线扩容能力、可扩展的资源自动调度机制，以及多粒度的资源配额管理能力。同时kubernetes提供了完善的管理工具，这些工具覆盖了包括开发、测">
<meta name="twitter:image" content="https://s1.ax1x.com/2020/07/20/U4kh5j.png">
    
        <link rel="alternate" type="application/atom+xml" title="风向标 | 分享与创造" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">ai0by</h5>
          <a href="mailto:killnetsec@gmail.com" title="killnetsec@gmail.com" class="mail">killnetsec@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/">
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives">
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags">
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories">
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/api">
                <i class="icon icon-lg icon-api"></i>
                API
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/custom">
                <i class="icon icon-lg icon-link"></i>
                Link
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/2019/03/25/Hello_world.html">
                <i class="icon icon-lg icon-user"></i>
                About Me
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Ubuntu18.04部署Kubernetes(k8s)集群可视化界面Dashboard</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Ubuntu18.04部署Kubernetes(k8s)集群可视化界面Dashboard</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-07-23T01:12:57.000Z" itemprop="datePublished" class="page-time">
  2020-07-23
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/架构/">架构</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#k8s概念"><span class="post-toc-number">1.</span> <span class="post-toc-text">k8s概念</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#架构"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">架构</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Kubernetes-Service"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Kubernetes Service</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Kubernetes-Pod"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">Kubernetes Pod</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Pod-amp-Container"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">Pod &amp; Container</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#参考文档"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">参考文档</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#部署k8s"><span class="post-toc-number">2.</span> <span class="post-toc-text">部署k8s</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#机器选择"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">机器选择</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#部署环境"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">部署环境</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Master节点部署"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">Master节点部署</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#子节点加入到集群"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">子节点加入到集群</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#安装Dashboard"><span class="post-toc-number">3.</span> <span class="post-toc-text">安装Dashboard</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#官方文档方式启动-不建议"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">官方文档方式启动(不建议)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#端口-IP启动-推荐"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">端口+IP启动(推荐)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#赋予用户权限"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">赋予用户权限</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#常用k8s命令"><span class="post-toc-number">4.</span> <span class="post-toc-text">常用k8s命令</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Ubuntu18-04部署Kubernetes-k8s-集群可视化界面Dashboard" class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Ubuntu18.04部署Kubernetes(k8s)集群可视化界面Dashboard</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-07-23 09:12:57" datetime="2020-07-23T01:12:57.000Z" itemprop="datePublished">2020-07-23</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/架构/">架构</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style="display:none">
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="k8s概念"><a href="#k8s概念" class="headerlink" title="k8s概念"></a>k8s概念</h2><h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><blockquote>
<p>Kubernetes是一个完备的分布式系统支撑平台。Kubernetes具有完备的集群管理能力，包括多层次的安全防护和准入机制/多租户应用支撑能力、透明的服务注册和服务发现机制、内建智能负载均衡器、强大的故障发现和自我修复功能、服务滚动升级和在线扩容能力、可扩展的资源自动调度机制，以及多粒度的资源配额管理能力。同时kubernetes提供了完善的管理工具，这些工具覆盖了包括开发、测试部署、运维监控在内的各个环节；因此kubernetes是一个全新的基于容器技术的分布式架构解决方案，并且是一个一站式的完备的分布式系统开发和支撑平台</p>
</blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s1.ax1x.com/2020/07/20/U4kh5j.png" alt="Kubernetes简易.png" title>
                </div>
                <div class="image-caption">Kubernetes简易.png</div>
            </figure>
<h3 id="Kubernetes-Service"><a href="#Kubernetes-Service" class="headerlink" title="Kubernetes Service"></a>Kubernetes Service</h3><blockquote>
<p><code>Service</code>的服务进程目前都基于<code>Socker</code>通信方式对外提供服务，比如redis、memcache、MySQL、Web Server，或者是实现了某个具体业务的一个特定的TCP Server进程。虽然一个<code>Service</code>通常由多个相关的服务进程来提供服务，每个服务进程都有一个独立的Endpoint(IP+Port)访问点，但Kubernetes 能够让我们通过<code>Service</code>虚拟<code>Cluster IP+Service Port</code>连接到指定的<code>Service上</code>。有了<code>Kubernetes</code>内建的透明负载均衡和故障恢复机制，不管后端有多少服务进程，也不管某个服务进程是否会由于发生故障而重新部署到其他机器，都不会影响到我们对服务的正常调用。更重要的是这个<code>Service</code>本身一旦创建就不再变化，这意味着<code>Kubernetes</code>集群中，我们再也不用为了服务的IP地址变来变去的问题而头疼。</p>
</blockquote>
<p><code>service</code>可以通过访问点去访问不同的子节点下面的<code>Pod</code>上，类似一个<code>Proxy</code>的概念，个人理解为他本身类似集群，通过<code>service</code>分发<br>与<code>swarm</code>集群中的<code>service</code>类似，可以保持容器启动数量，由于权限相关问题，用户手动命令要大于service控制的权限级别，因此如果在使用<code>service</code>控制<code>Pod</code>时，有可能导致报错，不推荐使用<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s1.ax1x.com/2020/07/20/U4AzTg.png" alt="Kubernetes Service.png" title>
                </div>
                <div class="image-caption">Kubernetes Service.png</div>
            </figure></p>
<h3 id="Kubernetes-Pod"><a href="#Kubernetes-Pod" class="headerlink" title="Kubernetes Pod"></a>Kubernetes Pod</h3><blockquote>
<p>Pod运行在一个我们称之为节点Node的环境中，可以是私有云也可以是公有云的虚拟机或者物理机，通常在一个节点上运行几百个Pod;其次，每个Pod里运行着一个特殊的被称之为Pause的容器，其他容器则为业务容器，这些业务容器共享Pause容器的网络栈和Volume挂载卷，因此他们之间的通讯和数据交换更为高效。在设计时我们可以充分利用这一特征将一组密切相关的服务进程放入同一个Pod中。<br>并不是每个Pod和它里面运行的容器都能映射到一个Service 上，只有那些提供服务(无论是对内还是对外)的一组Pod才会被映射成一个服务。</p>
</blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s1.ax1x.com/2020/07/21/UIKJMQ.png" alt="Kubernetes Pod.png" title>
                </div>
                <div class="image-caption">Kubernetes Pod.png</div>
            </figure>
<h3 id="Pod-amp-Container"><a href="#Pod-amp-Container" class="headerlink" title="Pod &amp; Container"></a>Pod &amp; Container</h3><ul>
<li><p>容器（Container）是一种高度隔离的封装程序</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s1.ax1x.com/2020/07/21/UIDylQ.png" alt="容器1.png" title>
                </div>
                <div class="image-caption">容器1.png</div>
            </figure>
<p>非所有的应用都适合选择容器，开发者可以根据自己应用的特点和需求选择最适合的计算单元。例如，你的应用是高性能、互信的，且处于同一个管理区域，那么用线程或者进程就可以满足；但如果你的应用是多租户的，并且和其他应用运行在同一个空间，那么你就需要考虑如何将这些应用安全地隔离开，使得数据不会被泄露或性能受到影响。那么这时，容器也许就是一个不错的选择了。<br>容器便于管理，因为现在市场上有着完全完善的生态以及<code>Docker</code>的支持度愈发增加，越来越多的公司（个人）选择<code>Docker</code>，我个人也更倾向于<code>Docker</code>，有了<code>Docker</code>就可以非常完美的管理<code>Images</code>以及<code>Container</code></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s1.ax1x.com/2020/07/21/UIrVtf.png" alt="容器2.png" title>
                </div>
                <div class="image-caption">容器2.png</div>
            </figure>
<p>容器是只占用很少的空间的，真正占用空间大的是<code>Images</code>，也可以说 <code>Container</code> 依赖 <code>Images</code></p>
</li>
<li><p>Pod，一种增强型容器<br>Pod是一种组合的多容器运行单元，也是Kubernetes里的一个基础单元。你可以把它看作是一种容器的扩展或者增强型的容器。Pod里面包括一个主容器和数个辅助容器，它们共同完成一个特定的功能。把多个进程（容器也是一种隔离的进程）打包在一个Name Space里的时候，就构成了一个Pod。Pod里面不同进程的应用包装仍然是独立的（每个容器都会有自己的镜像）。<br>Pod的意义在于，它可以既保持主容器和辅助容器的的密切关系，又保持主容器的独立性。由于主容器和辅助容器的生命周期相同，可以同时被创建和销毁，因此把它们放在一个Pod中，可以使他们的交互更加高效。</p>
</li>
</ul>
<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a href="https://www.sohu.com/a/382769383_115128" target="_blank" rel="noopener">Aholiab - 云原生的基石，一文读懂容器、Docker、Pod到底是什么！ </a><br><a href="https://k.i4t.com/" target="_blank" rel="noopener">abcdocker编写k8s中文文档</a><br><a href="https://k8sops.cn/ubuntu_kubeadm/" target="_blank" rel="noopener">Ubuntu18.04使用kubeadm部署v1.18 HA集群</a></p>
<h2 id="部署k8s"><a href="#部署k8s" class="headerlink" title="部署k8s"></a>部署k8s</h2><h3 id="机器选择"><a href="#机器选择" class="headerlink" title="机器选择"></a>机器选择</h3><p>这里我只做学习用途，因此开通的是阿里的按量计费机器以及低配置机器</p>
<ul>
<li>master01     2H8G  阿里云 Ubuntu18.04</li>
<li>node01     2H8G  阿里云 Ubuntu18.04</li>
</ul>
<h3 id="部署环境"><a href="#部署环境" class="headerlink" title="部署环境"></a>部署环境</h3><p><strong>Ubuntu修改仓库镜像</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sudo cat &gt; /etc/apt/sources.list &lt;&lt; EOF</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></p>
<p><strong>关闭防火墙</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw disable</span><br></pre></td></tr></table></figure></p>
<p><strong>时间同步</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install chrony -y &amp;&amp; sudo systemctl start chrony &amp;&amp; sudo systemctl enable chrony</span><br><span class="line"></span><br><span class="line">#查看chrony连接的公网服务器</span><br><span class="line">cat /etc/chrony/chrony.conf </span><br><span class="line">pool ntp.ubuntu.com        iburst maxsources 4</span><br><span class="line">pool 0.ubuntu.pool.ntp.org iburst maxsources 1</span><br><span class="line">pool 1.ubuntu.pool.ntp.org iburst maxsources 1</span><br><span class="line">pool 2.ubuntu.pool.ntp.org iburst maxsources 2</span><br></pre></td></tr></table></figure></p>
<p><strong>禁用swap</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo swapoff -a</span><br></pre></td></tr></table></figure></p>
<p>上述命令可以临时禁用掉swap，如果想要永久禁止，需要编辑 <code>/etc/fstab</code> 文件,将swap那一行注释掉，如果没有则不管</p>
<p><strong>禁用SELinux</strong><br>如果安装了则需要禁止掉，如果没有安装则可以跳过此步骤<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo setenforce 0           #临时关闭</span><br><span class="line">sudo vi /etc/selinux/config #永久关闭</span><br><span class="line">SELINUX=permissive</span><br></pre></td></tr></table></figure></p>
<p><strong>修改内核</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo  cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward = 1                     #开启ipv4转发，允许内置路由</span><br><span class="line">EOF</span><br><span class="line">sudo sysctl --system</span><br></pre></td></tr></table></figure></p>
<p><strong>修改时区</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -snf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line">sudo bash -c &quot;echo &apos;Asia/Shanghai&apos; &gt; /etc/timezone&quot;</span><br></pre></td></tr></table></figure></p>
<p><strong>安装Docker</strong><br>Step 1: 安装必要的一些系统工具<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common</span><br></pre></td></tr></table></figure></p>
<p>Step 2: 安装GPG证书<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure></p>
<p>Step 3: 写入软件源信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository &quot;deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot;</span><br></pre></td></tr></table></figure></p>
<p>Step 4: 查找Docker-CE的版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-cache madison docker-ce</span><br></pre></td></tr></table></figure></p>
<p>Step 5: 安装指定版本的Docker-CE,docker-ce=<a href="如果安装最新版本则无需带版本号">VERSION</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -y install docker-ce</span><br></pre></td></tr></table></figure></p>
<p>Setp 6: 安装完成后Docker默认就已经启动和加入开机自启了，这点我们不需要再做了，不过可以检查一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status docker</span><br><span class="line">sudo systemctl is-enabled docker</span><br></pre></td></tr></table></figure></p>
<p>Setp 7:  配置Docker镜像加速以及指定cgroup驱动为systemd<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&apos;EOF&apos;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://81z69sad.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure></p>
<p>Setp 8:  配置完成后使用 docker info 可以看到修改的配置信息</p>
<p><strong>配置主机名</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt; EOF</span><br><span class="line">172.26.147.37  master01</span><br><span class="line">172.26.147.36  node01</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></p>
<p><strong>安装Kubeadm Kubelet Kubectl</strong><br>Step 1: 安装必要的程序包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update &amp;&amp; apt-get install -y apt-transport-https</span><br></pre></td></tr></table></figure></p>
<p>Step 2: 导入Kubernetes官方包签名密钥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add -</span><br></pre></td></tr></table></figure></p>
<p>Step 3: 添加Kubernetes仓库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/apt/sources.list.d/kubernetes.list &lt;&lt; EOF</span><br><span class="line">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></p>
<p>Step 4: 更新仓库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br></pre></td></tr></table></figure></p>
<p>Step 5: 查找kubeadm kubelet kubectl版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-cache madison kubeadm | grep 1.18</span><br><span class="line">apt-cache madison kubelet | grep 1.18</span><br><span class="line">apt-cache madison kubectl | grep 1.18</span><br></pre></td></tr></table></figure></p>
<p>目前1.18发布了1.18.0-00 1.18.1-00 1.18.2-00 三个版本</p>
<p>Step 6: 指定版本安装kubelet kubeadm kubectl(如果安装最新版本则无需带版本号)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install kubeadm kubelet kubectl -y</span><br></pre></td></tr></table></figure></p>
<h3 id="Master节点部署"><a href="#Master节点部署" class="headerlink" title="Master节点部署"></a>Master节点部署</h3><p><strong>根据需要修改的参数更换以下内容</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init \</span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers \</span><br><span class="line">--kubernetes-version v1.18.0 \</span><br><span class="line">--control-plane-endpoint master01 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16 \</span><br><span class="line">--service-cidr=10.96.0.0/12 \</span><br><span class="line">--apiserver-advertise-address=0.0.0.0 \</span><br><span class="line">--ignore-preflight-errors=Swap \</span><br><span class="line">--token-ttl 30m</span><br></pre></td></tr></table></figure></p>
<p><strong>参数说明</strong></p>
<ul>
<li>image-repository：初始化过程中会去docker仓库拉去镜像，默认指定的为docker hub(国内访问网速不堪)，所以在此使用–image-repository参数指定阿里云镜像。</li>
<li>kubernetes-version：指定正在使用的 Kubernetes 程序组件的版本号，需要与 kubelet kubeadm kubectl 的版本号一致。</li>
<li>control-plane-endpoint: 指定控制平面的固定访问端点，可以是IP地址或DNS名称，会被用于集群管理员及集群组件的kubeconfig配置文件API Server的访问地址；单控制平面部署时可以不使用该选项(如果是单个Master部署则不需要使用该选项，因为等会我们要再加入其它两个Master节点到控制平面，所以这里加上此参数)。</li>
<li>pod-network-cidr：Pod 网络的地址范围，其值为 CIDR 格式的网络地址，使用 flannel 网络插件时，其默认地址为 10.244.0.0/16。</li>
<li>service-cidr：Service 的网络地址范围，其值为 CIDR 格式的网络地址，默认地址为 10.96.0.0/12。</li>
<li>apiserver-advertise-address：API Server 通告给其它组件的IP地址，一般为 Master 节点的IP地址，0.0.0.0 标识节点上所有可用的地址。<br>ignore-preflight-errors：忽略哪些运行时的错误信息，其值为 Swap 时，表示忽略因 swap 未关闭而导致的错误。</li>
<li>token-ttl：token令牌自动删除时间，默认为24小时，指定为 0 表示永不过期，指定单位可以使 秒s 分m 时h，在node加入Kubernetes集群时需要指定token。<br><strong>初始化过程</strong><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s1.ax1x.com/2020/07/22/UHburQ.png" alt="01.png" title>
                </div>
                <div class="image-caption">01.png</div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s1.ax1x.com/2020/07/22/UHb15q.png" alt="02.png" title>
                </div>
                <div class="image-caption">02.png</div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s1.ax1x.com/2020/07/22/UHbNMF.png" alt="03.png" title>
                </div>
                <div class="image-caption">03.png</div>
            </figure>
<strong>初始化完成</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#您的Kubernetes控制平面初始化成功!</span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">#要开始使用您的集群，您需要作为一个普通用户运行以下程序:</span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line">  mkdir -p $HOME/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line"></span><br><span class="line">#你需要部署一个网络插件到集群中才能够使Kubernetes网络运转起来</span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">#如果要添加其它控制平面到集群中使用以下命令</span><br><span class="line">You can now join any number of control-plane nodes by copying certificate authorities</span><br><span class="line">and service account keys on each node and then running the following as root:</span><br><span class="line">  kubeadm join k8s-devops.io:6443 --token 8r7sjk.9a31rmcjot9650fe \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256: \</span><br><span class="line">    --control-plane</span><br><span class="line"></span><br><span class="line">#如果要添加数据平面节点到集群中使用以下命令</span><br><span class="line">Then you can join any number of worker nodes by running the following on each as root:</span><br><span class="line">kubeadm join k8s-devops.io:6443 --token 8r7sjk.9a31rmcjot9650fe \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>创建用户</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@master01:~# useradd -m -s /bin/bash k8s  # 创建用户</span><br><span class="line">root@master01:~# passwd k8s  					# 设置密码</span><br><span class="line">Enter new UNIX password:</span><br><span class="line">Retype new UNIX password:</span><br><span class="line">passwd: password updated successfully</span><br></pre></td></tr></table></figure></p>
<p>为普通用户提权<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@master01:~# echo &apos;k8s ALL=(ALL:ALL) NOPASSWD:ALL&apos; &gt;&gt; /etc/sudoers.d/k8s</span><br></pre></td></tr></table></figure></p>
<p>创建权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@master01:~# su k8s  # 切换用户</span><br><span class="line">k8s@master01:/root$    </span><br><span class="line">k8s@master01:/root$ cd /  # 切换目录</span><br><span class="line">k8s@master01:/$ mkdir -p $HOME/.kube                                     #在当前用户家目录下创建.kube目录</span><br><span class="line">k8s@master01:/$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config  #复制config命令配置文件到当前用户.kube目录下</span><br><span class="line">k8s@master01:/$ sudo chown $(id -u):$(id -g) $HOME/.kube/config           #修改config文件权限</span><br></pre></td></tr></table></figure></p>
<p><strong>部署网络插件</strong><br>Step 1: 可以直接在线部署(如果网络下载不了的情况下,也可以先试用浏览器下载后上传到服务器上)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">k8s@master01:/$ kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure></p>
<p>Step 2: 如果上述方法还是不行，则可以尝试使用我的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://api.0161.org/resources/kube-flannel.yml</span><br></pre></td></tr></table></figure></p>
<p>Step 3: 上传完后修改文件的属性信息(如上述1,2步骤已完成则直接跳过)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">k8s@master01:/$ sudo chown -Rf k8s.k8s kube-flannel.yml</span><br></pre></td></tr></table></figure></p>
<p>Step 4: 然后指定文件部署网络插件(如上述1,2步骤已完成则直接跳过)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">k8s@master01:/$ kubectl apply -f kube-flannel.yml</span><br><span class="line">podsecuritypolicy.policy/psp.flannel.unprivileged created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/flannel created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/flannel created</span><br><span class="line">serviceaccount/flannel created</span><br><span class="line">configmap/kube-flannel-cfg created</span><br><span class="line">daemonset.apps/kube-flannel-ds-amd64 created</span><br><span class="line">daemonset.apps/kube-flannel-ds-arm64 created</span><br><span class="line">daemonset.apps/kube-flannel-ds-arm created</span><br><span class="line">daemonset.apps/kube-flannel-ds-ppc64le created</span><br><span class="line">daemonset.apps/kube-flannel-ds-s390x created</span><br></pre></td></tr></table></figure></p>
<p>Step 5: 查看网络插件是否部署完成(下面有一个叫kube-flannel-ds-amd64的Pod)<br>如果发现你的 flannel Pod 处于 ImagePullBackOff 状态，那么就是 flannel 镜像未拉取成功，而正常的则为 Running状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">k8s@master01:/$ kubectl get pods -n kube-system | grep flannel</span><br><span class="line">kube-flannel-ds-amd64-hx9cr        1/1     Running   0          2m3s</span><br></pre></td></tr></table></figure></p>
<p>Step 6: 查看目前k8s节点信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">k8s@master01:/$ kubectl get nodes</span><br><span class="line">NAME       STATUS   ROLES    AGE   VERSION</span><br><span class="line">master01   Ready    master   65m   v1.18.6</span><br></pre></td></tr></table></figure></p>
<h3 id="子节点加入到集群"><a href="#子节点加入到集群" class="headerlink" title="子节点加入到集群"></a>子节点加入到集群</h3><p>master节点查看join参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm token create --print-join-command</span><br></pre></td></tr></table></figure></p>
<p>子节点运行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join master01:6443 --token 8z8ot9.ylyj39j1po0hgyun     --discovery-token-ca-cert-hash sha256:e0bb3c41**********************************813c84472f65c</span><br></pre></td></tr></table></figure></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s1.ax1x.com/2020/07/22/UHb0aR.png" alt="04.png" title>
                </div>
                <div class="image-caption">04.png</div>
            </figure>
<h2 id="安装Dashboard"><a href="#安装Dashboard" class="headerlink" title="安装Dashboard"></a>安装Dashboard</h2><h3 id="官方文档方式启动-不建议"><a href="#官方文档方式启动-不建议" class="headerlink" title="官方文档方式启动(不建议)"></a>官方文档方式启动(不建议)</h3><p>与端口+ip只能选择一种使用！！！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.3/aio/deploy/recommended.yaml</span><br></pre></td></tr></table></figure></p>
<p>如遇到无法访问或者网络连接问题可以使用我的备份文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://api.0161.org/resources/recommended.yaml</span><br></pre></td></tr></table></figure></p>
<p>代理方式启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl proxy</span><br></pre></td></tr></table></figure></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s1.ax1x.com/2020/07/22/UHbhdA.png" alt="05.png" title>
                </div>
                <div class="image-caption">05.png</div>
            </figure>
<h3 id="端口-IP启动-推荐"><a href="#端口-IP启动-推荐" class="headerlink" title="端口+IP启动(推荐)"></a>端口+IP启动(推荐)</h3><p><strong>环境部署</strong><br>下载文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://k8s-1252147235.cos.ap-chengdu.myqcloud.com/dashboard/dashboard.yaml</span><br></pre></td></tr></table></figure></p>
<p>拉取镜像<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kubernetes-dashboard-amd64:v1.10.1</span><br></pre></td></tr></table></figure></p>
<p>创建服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo kubectl apply -f dashboard.yaml</span><br></pre></td></tr></table></figure></p>
<p>浏览器输入 <code>https://IP:30001</code> 打开 （可以使用Safari或者火狐，Chrome无法访问）<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s1.ax1x.com/2020/07/22/UHb7z8.png" alt="06.png" title>
                </div>
                <div class="image-caption">06.png</div>
            </figure><br><strong>绑定用户</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo kubectl create serviceaccount dashboard-admin -n kube-system</span><br><span class="line">kubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard</span><br></pre></td></tr></table></figure></p>
<p><strong>获取Token</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe secrets -n kube-system $(kubectl -n kube-system get secret | awk &apos;/dashboard-admin/&#123;print $1&#125;&apos;)</span><br></pre></td></tr></table></figure></p>
<p>按Token启动<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://s1.ax1x.com/2020/07/22/UHqnW6.png" alt="07.png" title>
                </div>
                <div class="image-caption">07.png</div>
            </figure></p>
<h3 id="赋予用户权限"><a href="#赋予用户权限" class="headerlink" title="赋予用户权限"></a>赋予用户权限</h3><p><strong>单命名空间权限文件及绑定</strong><br>创建 role.yaml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">kind: Role</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  name: role-dashboard-admin</span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [&quot;&quot;]</span><br><span class="line">  resources: [&quot;pods&quot;,&quot;services&quot;]</span><br><span class="line">  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]</span><br><span class="line">- apiGroups: [&quot;extensions&quot;, &quot;apps&quot;]</span><br><span class="line">  resources: [&quot;deployments&quot;]</span><br><span class="line">  verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;update&quot;, &quot;patch&quot;, &quot;delete&quot;]</span><br></pre></td></tr></table></figure></p>
<p>创建 role-bind.yaml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">kind: RoleBinding</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: role-bind-dashboard-admin</span><br><span class="line">  namespace: kube-system</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: dashboard-admin</span><br><span class="line">  namespace: kube-system</span><br><span class="line">roleRef:</span><br><span class="line">  kind: Role</span><br><span class="line">  name: role-dashboard-admin</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br></pre></td></tr></table></figure></p>
<p><strong>集群权限配置及绑定</strong><br>创建 cluster-role.yaml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kind: ClusterRole</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line"> name: cluster-role-dashboard-admin</span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [&quot;&quot;]</span><br><span class="line">  resources: [&quot;pods&quot;]</span><br><span class="line">  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]</span><br></pre></td></tr></table></figure></p>
<p>创建 cluster-role-bind.yaml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">kind: ClusterRoleBinding</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line"> name: cluster-role-bind-dashboard-admin</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line"> name: dashboard-admin</span><br><span class="line"> apiGroup: rbac.authorization.k8s.io</span><br><span class="line">roleRef:</span><br><span class="line"> kind: ClusterRole</span><br><span class="line"> name: cluster-role-dashboard-admin</span><br><span class="line"> apiGroup: rbac.authorization.k8s.io</span><br></pre></td></tr></table></figure></p>
<p>执行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f role.yaml</span><br><span class="line">kubectl create -f role-bind.yaml</span><br><span class="line">kubectl create -f cluster-role.yaml</span><br><span class="line">kubectl create -f cluster-role-bind.yaml</span><br></pre></td></tr></table></figure></p>
<p>完成权限配置，可根据自身情况增加配置！</p>
<h2 id="常用k8s命令"><a href="#常用k8s命令" class="headerlink" title="常用k8s命令"></a>常用k8s命令</h2><ul>
<li><p>查看pod列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods --all-namespaces   # 查看所有</span><br><span class="line">sudo kubectl get pod -n kube-system # 查看指定命名空间</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看service列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get service --all-namespaces   # 查看所有</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除指定命名空间下的service</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete service serviceName --namespace=namespaceName</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除指定命名空间下的pod</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod podName --namespace=namespaceName</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看所有deployment</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deployment -A</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除指定deployment</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete deployment podName</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看指定命名空间端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo kubectl get pod,svc -n kube-system</span><br></pre></td></tr></table></figure></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-07-23T06:03:37.256Z" itemprop="dateUpdated">2020-07-23 14:03:37</time>
</span><br>


        
        承接各类外包私活，有意邮箱联系 killnetsec#gmail.com~
        
    </div>
    
    <footer>
        <a href="https://sbcoder.cn">
            <img src="/img/avatar.jpg" alt="ai0by">
            ai0by
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/">Docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/架构/">架构</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://sbcoder.cn/2020/07/23/Kubernetes-Ubuntu.html&title=《Ubuntu18.04部署Kubernetes(k8s)集群可视化界面Dashboard》 — 风向标 | 分享与创造&pic=https://sbcoder.cn/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://sbcoder.cn/2020/07/23/Kubernetes-Ubuntu.html&title=《Ubuntu18.04部署Kubernetes(k8s)集群可视化界面Dashboard》 — 风向标 | 分享与创造&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://sbcoder.cn/2020/07/23/Kubernetes-Ubuntu.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Ubuntu18.04部署Kubernetes(k8s)集群可视化界面Dashboard》 — 风向标 | 分享与创造&url=https://sbcoder.cn/2020/07/23/Kubernetes-Ubuntu.html&via=https://sbcoder.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://sbcoder.cn/2020/07/23/Kubernetes-Ubuntu.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/07/24/rancher-install.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">使用Rancher快速部署k8s集群</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/06/10/Redis-Backup.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Redis持久化及数据备份</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: '288baabedd78311b1394',
          clientSecret: 'd82c9d2ea22f06844ebecc14b8c62f91aedb4f3b',
          repo: 'ai0by.github.io',
          owner: 'ai0by',
          admin: ['ai0by'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style="display:none">
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style="display:none">
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>ai0by &copy; 2015 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://sbcoder.cn/2020/07/23/Kubernetes-Ubuntu.html&title=《Ubuntu18.04部署Kubernetes(k8s)集群可视化界面Dashboard》 — 风向标 | 分享与创造&pic=https://sbcoder.cn/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://sbcoder.cn/2020/07/23/Kubernetes-Ubuntu.html&title=《Ubuntu18.04部署Kubernetes(k8s)集群可视化界面Dashboard》 — 风向标 | 分享与创造&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://sbcoder.cn/2020/07/23/Kubernetes-Ubuntu.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Ubuntu18.04部署Kubernetes(k8s)集群可视化界面Dashboard》 — 风向标 | 分享与创造&url=https://sbcoder.cn/2020/07/23/Kubernetes-Ubuntu.html&via=https://sbcoder.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://sbcoder.cn/2020/07/23/Kubernetes-Ubuntu.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACLUlEQVR42u3awW6EMAxFUf7/p6nUVSUUuM8uVce5WY0YJuSw8Dh2jgOP83v8/Hwdq2/JDNfrxxtDhgwZH8s4b8d1EatlrZZyP89qJXxtMmTI2IfBgyx5BelsKVuGDBkyatPd38MDugwZMmT0A24aiDtBVoYMGTLSgJgGTV5uS++UIUPGboxaY+BvPr/e35AhQ8a/Z5zh6JTe0sJcsCoZMmSMZpD2ZBp2+SY2xT+EYxkyZAxlkCQs3dDWjm4Q6vKKDBkyRjPuf5weqiCBsr/nfvjfkCFDxjgGWRZH8lId38SiYpwMGTJGM3i47Gw4OSNNHx82tDJkyBjBqG1NO8GUp4lkZhkyZOzDIA9OC3D9TTJpOciQIWMHBk8E03QtbXbyV7a8LkOGjKGMNHTyNK5WPuMzy5AhYzfG7yZ8taCcvpSgUihDhowPZ9QOh9UOTPC2ZfFwmAwZMrZh8LYlx/SbnahsJ0OGjKGM9DhX53BGp7SHym0yZMgYyghKWi8kjp1jZGhHLkOGjBGM+5vSAFprYaaNh/gtypAhYwSDF/RrryBtAMQJqwwZMkYz+AELnkSmxbtac0KGDBn7MM5w8EMY/UQwmF+GDBmjGXzUSva1bS0P6zJkyNiH0Xlwp21ZC7hB7VCGDBnjGCTIpiljpz3A1yNDhgwZZIpaWa0/fzHgypAhYzNGLezy0Mx/JUOGjB0Y/PG1oxJkhloQlyFDxg6M/gaStxs5JmXLkCFjKOMLwajmVEsw4AgAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '哎呦！网页崩溃了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
